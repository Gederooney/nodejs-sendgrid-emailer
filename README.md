# Node.js SendGrid Emailer

This project is a simple yet effective email sender using Node.js and SendGrid. It provides two main functionalities: adding a new contact to a list and sending an email.

## Project Structure

1. `app.mjs`: This file configures the Express application, sets up middleware, and includes routing. It also sets up the CORS policy&#8203;``oaicite:{"number":1,"metadata":{"title":"nodejs-sendgrid-emailer/app.mjs at master · Gederooney/nodejs-sendgrid-emailer · GitHub","url":"https://github.com/Gederooney/nodejs-sendgrid-emailer/blob/master/src/app.mjs","text":"import express, { urlencoded, json } from \"express\";  \n import helmet from \"helmet\";  \n import morgan from \"morgan\";  \n import router from \"./routes/index.mjs\";  \n import cors from \"cors\";  \n\n const app = express();  \n\n const whitelist = [  \n  \"http://localhost:8080\",  \n  \"https://omnidev.ca/\",  \n  \"https://omnigo.ca/\",  \n ];  \n const corsOptions = {  \n  origin: \"*\",  \n };  \n\n app.use(cors(corsOptions));  \n app.use(urlencoded({ extended: true }));  \n app.use(json());  \n app.use(\"/\", router);  \n\n export default app","pub_date":null}}``&#8203;.

2. `server.mjs`: This file creates the HTTP server and starts listening on a specified port&#8203;``oaicite:{"number":2,"metadata":{"title":"nodejs-sendgrid-emailer/server.mjs at master · Gederooney/nodejs-sendgrid-emailer · GitHub","url":"https://github.com/Gederooney/nodejs-sendgrid-emailer/blob/master/src/server.mjs","text":"import http from \"http\";  \n import app from \"./app.mjs\";  \n import { config } from \"dotenv\";  \n\n config();  \n\n const port = process.env.PORT || 3000;  \n\n const server = http.createServer(app);  \n\n server.listen(port","pub_date":null}}``&#8203;.

3. `addContact.routes.mjs`: This file handles the route for adding a new contact to a SendGrid list. It validates the incoming request data and, if valid, sends a request to the SendGrid API to add the contact&#8203;``oaicite:{"number":3,"metadata":{"title":"nodejs-sendgrid-emailer/addContact.routes.mjs at master · Gederooney/nodejs-sendgrid-emailer · GitHub","url":"https://github.com/Gederooney/nodejs-sendgrid-emailer/blob/master/src/routes/addContact.routes.mjs","text":"import { Router } from \"express\";  \n import { config } from \"dotenv\";  \n import client from \"@sendgrid/client\";  \n import { check, validationResult } from \"express-validator\";  \n\n config();  \n const addListRouter = new Router();  \n const key = process.env.SENDGRID_APIKEY;  \n client.setApiKey(key);  \n\n addListRouter.post(  \n  \"/add\",  \n  check(  \n  \"email\",  \n  \"please check your email before sending it to the server\"  \n  ).isEmail(),  \n  (req, res) => {  \n  const errors = validationResult(req);  \n  if (errors.isEmpty()) {  \n  const { email } = req.body;  \n  const data = {  \n  list_ids: [\"4651deea-06e2-4b13-9ecd-af57c7ef3b25\"],  \n  contacts: [  \n  {  \n  email,  \n  },  \n  ],  \n  };  \n\n  const request = {  \n  url: `/v3/marketing/contacts`,  \n  method: \"PUT\",  \n  body: data,  \n  };  \n\n  client  \n  .request(request)  \n  .then(([response, body]) => {  \n  if (response.statusCode === 202) {  \n  return res.status(200).send({  \n  sucess: true,  \n  message: \"email added\",  \n  ...response.body,  \n  });  \n  }  \n  return res  \n  .status(500)  \n  .send({ message: \"internal server error\" });  \n  })  \n  .catch((error) => {  \n  console.error(error.response.body);  \n  return res  \n  .status(500)  \n  .send({ message: \"internal server error\" });  \n  });  \n  return;  \n  }  \n  return res.status(400).send({  \n  success: false,  \n  message: \"Bad request\",  \n  errors: errors.array(),  \n  received: req.body,  \n  });  \n  }  \n );  \n\n export default addListRouter","pub_date":null}}``&#8203;.

4. `index.mjs`: This file imports the routes from `addContact.routes.mjs` and `sendEmail.routes.mjs` and sets them up on the Express application. It also handles a root GET request&#8203;``oaicite:{"number":4,"metadata":{"title":"nodejs-sendgrid-emailer/index.mjs at master · Gederooney/nodejs-sendgrid-emailer · GitHub","url":"https://github.com/Gederooney/nodejs-sendgrid-emailer/blob/master/src/routes/index.mjs","text":"import { Router } from \"express\";  \n import addListRouter from \"./addContact.routes.mjs\";  \n import sendEmailRouter from \"./sendEmail.routes.mjs\";  \n\n const router = new Router();  \n\n router.get(\"/\", (req, res) => res.send(\"good\"));  \n router.use(\"/contact\", addListRouter);  \n router.use(\"/email\", sendEmailRouter);  \n\n export default router","pub_date":null}}``&#8203;.

5. `sendEmail.routes.mjs`: This file handles the route for sending an email. It validates the incoming request data and, if valid, sends an email via the SendGrid API&#8203;``oaicite:{"number":5,"metadata":{"title":"nodejs-sendgrid-emailer/sendEmail.routes.mjs at master · Gederooney/nodejs-sendgrid-emailer · GitHub","url":"https://github.com/Gederooney/nodejs-sendgrid-emailer/blob/master/src/routes/sendEmail.routes.mjs","text":"import { Router } from \"express\";  \n import { config } from \"dotenv\";  \n import client from \"@sendgrid/mail\";  \n import { check, validationResult } from \"express-validator\";  \n\n config();  \n const sendEmailRouter = new Router();  \n const key = process.env.SENDGRID_APIKEY;  \n client.setApiKey(key);  \n\n sendEmailRouter.post(  \n  \"/contactEmail\",  \n  [  \n  check(\"username\", \"userame is mandatory\").isAlpha().notEmpty(),  \n  check(\"email\", \"email is not valid\").isEmail().notEmpty(),  \n  check(\"description\", \"description is mandatory\"),  \n  ],  \n  (req, res) => {  \n  const errors = validationResult(req);  \n  const { email, username, description } = req.body;  \n  if (errors.isEmpty()) {  \n  const message = {  \n  to: [\"email\", \"email\"],  \n  from: \"email\",  \n  subject: \"Nouveau formulaire de contact\",  \n  html: `  \n  <p>Bonjour, ${username} demande à être contacter</p>  \n  <p>Il vous a laissé ce commentaire: ${description}</p>  \n  <p>Envoyez lui un email en cliquant <strong><a href=\"mailto:${email}\">Ici</a><strong> ou répondez à ${email} quand vous êtes prèt  \n  `,  \n  };  \n  client  \n  .send(message)  \n  .then(() => {  \n  return res.status(200).send({ success: true });  \n  })  \n  .catch((error) => {  \n  console.error(error.message);  \n  return res.status(500).send({  \n  success: false,  \n  message: \"internal server error\",  \n  });  \n  });  \n  return;  \n  }  \n  return res.status(400).send({  \n  success: false,  \n  message: \"bad request\",  \n  errors: errors.array(),  \n  });  \n  }  \n );  \n\n export default sendEmailRouter","pub_date":null}}``&#8203;.

## How to Use

1. Clone this repository.
2. Install the dependencies using `npm install`.
3. Create a `.env` file in the root of your project and fill it with your SendGrid API key.
4. Start the server using `npm start`.
5. You can now send a POST request to `http://localhost:<port>/contact/add` to add a new contact, or to `http://localhost:<port>/email/contactEmail` to send an email.

Please note that this project is still under development, and functionality may change in the future.

## Contribution

Contributions are welcome. Please submit a Pull Request, and ensure that your code passes our linting standards.

## License

This project is licensed under the MIT License.
